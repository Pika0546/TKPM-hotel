{{#section 'head'}}
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Hotel Transylvania</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Fonts
		============================================ -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900" rel="stylesheet">
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <!-- owl.carousel CSS
		============================================ -->
    <link rel="stylesheet" href="/css/owl.carousel.css">
    <link rel="stylesheet" href="/css/owl.theme.css">
    <link rel="stylesheet" href="/css/owl.transitions.css">
    <!-- animate CSS
		============================================ -->
    <link rel="stylesheet" href="/css/animate.css">
    <!-- normalize CSS
		============================================ -->
    <link rel="stylesheet" href="/css/normalize.css">
    <!-- meanmenu icon CSS
		============================================ -->
    <link rel="stylesheet" href="/css/meanmenu.min.css">
    <!-- main CSS
		============================================ -->
    <link rel="stylesheet" href="/css/main.css">
    <!-- educate icon CSS
		============================================ -->
    <link rel="stylesheet" href="/css/educate-custon-icon.css">
    <!-- morrisjs CSS
		============================================ -->
    <link rel="stylesheet" href="/css/morrisjs/morris.css">
    <!-- mCustomScrollbar CSS
		============================================ -->
    <link rel="stylesheet" href="/css/scrollbar/jquery.mCustomScrollbar.min.css">
    <!-- metisMenu CSS
		============================================ -->
    <link rel="stylesheet" href="/css/metisMenu/metisMenu.min.css">
    <link rel="stylesheet" href="/css/metisMenu/metisMenu-vertical.css">
    <!-- calendar CSS
		============================================ -->
    <link rel="stylesheet" href="/css/calendar/fullcalendar.min.css">
    <link rel="stylesheet" href="/css/calendar/fullcalendar.print.min.css">
    <!-- x-editor CSS
		============================================ -->
    <link rel="stylesheet" href="/css/editor/select2.css">
    <link rel="stylesheet" href="/css/editor/datetimepicker.css">
    <link rel="stylesheet" href="/css/editor/bootstrap-editable.css">
    <link rel="stylesheet" href="/css/editor/x-editor-style.css">
    <!-- normalize CSS
        ============================================ -->
    <link rel="stylesheet" href="/css/data-table/bootstrap-table.css">
    <link rel="stylesheet" href="/css/data-table/bootstrap-editable.css">
    <!-- style CSS
		============================================ -->
			<link rel="stylesheet" href="/css/alerts.css">
    <link rel="stylesheet" href="/style.css">
	<link rel="stylesheet" href="/css/my-css.css">
    <!-- responsive CSS
		============================================ -->
    <link rel="stylesheet" href="/css/responsive.css">
    <!-- modernizr JS
		============================================ -->
    <script src="/js/vendor/modernizr-2.8.3.min.js"></script>
{{/section}}

 <div class="container-fluid mg-b-15 mg-t-30" style="display: flex; flex-direction:column;  width: 100%">
	<div class="product-status-wrap" style="flex: 1 1 auto; display:flex; flex-direction:column">
		<div class="row mg-b-10">
			<div class="text-center context-box" style="padding: 0 20px">
				<h2 class="mg-b-10">Báo cáo Doanh Thu theo loại phòng</h2>
				<div class="row">
					<div class="col-12 col-md-6">
						<div style="display: flex; align-items:center; flex-direction: row">
							<label style="margin:0; margin-right: 15px">Tháng: </label>
							<select onchange="roomTypeSubmitQuery(this)" class="form-control custom-select-value" id="month1" name="month1">
							
							</select>
						</div>
					</div>
					<div class="col-12 col-md-6">
						<div style="display: flex; align-items:center; flex-direction: row">
							<label style="margin:0; margin-right: 15px">Năm: </label>
							<select onchange="roomTypeSubmitQuery(this)" name="year1" id="year1" class="form-control custom-select-value"></select>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row" id="data-container-1">
			<div class="col-12 col-md-6">
				<div id="room-type-chart-container">
					<canvas id="room-type-chart"></canvas>
				</div>
			</div>
			<div class="col-12 col-md-6">
				<div class="table-sticky-head">
					<table >
						<thead>
							<th>STT</th>
							<th>Loại phòng</th>
							<th>Doanh thu</th>
							<th>Tỉ lệ</th>
						</thead>
						<tbody id="table-body-1">
							{{#each resultRoomTypeArr}}
								<tr>
									<td>{{sum @index 1}}</td>
									<td>{{this.type}}</td>
									<td>{{currency this.value}}</td>
									<td>{{ratio this.ratio}}</td>
								</tr>
							{{/each}}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

	<div class="product-status-wrap mg-t-15" style="flex: 1 1 auto; display:flex; flex-direction:column">
		<div class="row mg-b-10">
			<div class="text-center context-box" style="padding: 0 20px">
				<h2 class="mg-b-10">Báo cáo Mật độ sử dụng phòng</h2>
				<div class="row">
					<div class="col-12 col-md-6">
						<div style="display: flex; align-items:center; flex-direction: row">
							<label style="margin:0; margin-right: 15px">Tháng: </label>
							<select onchange="roomDensitySubmitQuery(this)" class="form-control custom-select-value" id="month2" name="month2">
							
							</select>
						</div>
					</div>
					<div class="col-12 col-md-6">
						<div style="display: flex; align-items:center; flex-direction: row">
							<label style="margin:0; margin-right: 15px">Năm: </label>
							<select onchange="roomDensitySubmitQuery(this)" name="year2" id="year2" class="form-control custom-select-value"></select>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row" id="data-container-2">
			<div class="col-12 col-md-6">
				<div id="room-density-chart-container">
					<canvas id="room-density-chart"></canvas>
				</div>
			</div>
			<div class="col-12 col-md-6">
				<div class="table-sticky-head">
					<table >
						<thead>
							<th>STT</th>
							<th>Phòng</th>
							<th>Số ngày thuê</th>
							<th>Tỉ lệ</th>
						</thead>
						<tbody id="table-body-2">
							{{#each resultRoomDensityArr}}
								<tr>
									<td>{{sum @index 1}}</td>
									<td>{{this.room}}</td>
									<td>{{this.value}}</td>
									<td>{{ratio this.ratio}}</td>
								</tr>
							{{/each}}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>

{{#section 'script'}}
    <!-- jquery
		============================================ -->
    <script src="/js/vendor/jquery-1.12.4.min.js"></script>
    <!-- bootstrap JS
		============================================ -->
    <script src="/js/bootstrap.min.js"></script>
    <!-- wow JS
		============================================ -->
    <script src="/js/wow.min.js"></script>
    <!-- price-slider JS
		============================================ -->
    <script src="/js/jquery-price-slider.js"></script>
    <!-- meanmenu JS
		============================================ -->
    <script src="/js/jquery.meanmenu.js"></script>
    <!-- owl.carousel JS
		============================================ -->
    <script src="/js/owl.carousel.min.js"></script>
    <!-- sticky JS
		============================================ -->
    <script src="/js/jquery.sticky.js"></script>
    <!-- scrollUp JS
		============================================ -->
    <script src="/js/jquery.scrollUp.min.js"></script>
    <!-- counterup JS
		============================================ -->
    <script src="/js/counterup/jquery.counterup.min.js"></script>
    <script src="/js/counterup/waypoints.min.js"></script>
    <script src="/js/counterup/counterup-active.js"></script>
    <!-- mCustomScrollbar JS
		============================================ -->
    <script src="/js/scrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="/js/scrollbar/mCustomScrollbar-active.js"></script>
    <!-- metisMenu JS
		============================================ -->
    <script src="/js/metisMenu/metisMenu.min.js"></script>
    <script src="/js/metisMenu/metisMenu-active.js"></script>
    <!-- data table JS
		============================================ -->
    {{!-- <script src="/js/data-table/bootstrap-table.js"></script>--}}
    {{!-- <script src="/js/data-table/tableExport.js"></script> --}}
    {{!-- <script src="/js/data-table/data-table-active.js"></script> --}}
    {{!-- <script src="/js/data-table/bootstrap-table-editable.js"></script> --}}
    {{!-- <script src="/js/data-table/bootstrap-editable.js"></script> --}}
    {{!-- <script src="/js/data-table/bootstrap-table-resizable.js"></script> --}}
    {{!-- <script src="/js/data-table/colResizable-1.5.source.js"></script> --}}
    {{!-- <script src="/js/data-table/bootstrap-table-export.js"></script>  --}}

    <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.js"></script>

    <!--  editable JS
        ============================================ -->
    <script src="/js/editable/jquery.mockjax.js"></script>
    <script src="/js/editable/mock-active.js"></script>
    <script src="/js/editable/select2.js"></script>
    <script src="/js/editable/moment.min.js"></script>
    <script src="/js/editable/bootstrap-datetimepicker.js"></script>
    <script src="/js/editable/bootstrap-editable.js"></script>
    <script src="/js/editable/xediable-active.js"></script>
    <!-- Chart JS
        ============================================ -->
    {{!-- <script src="/js/chart/jquery.peity.min.js"></script>
    <script src="/js/peity/peity-active.js"></script> --}}
     <!-- Charts JS
		============================================ -->
    <script src="/js/charts/Chart.js"></script>
    {{!-- <script src="/js/charts/rounded-chart.js"></script> --}}
    <!-- tab JS
        ============================================ -->
    <script src="/js/tab.js"></script>
    <!-- morrisjs JS
		============================================ -->
    <script src="/js/morrisjs/raphael-min.js"></script>
    <script src="/js/morrisjs/morris.js"></script>
    {{!-- <script src="/js/morrisjs/morris-active.js"></script> --}}
    <!-- morrisjs JS
		============================================ -->
    <script src="/js/sparkline/jquery.sparkline.min.js"></script>
    <script src="/js/sparkline/jquery.charts-sparkline.js"></script>
    <script src="/js/sparkline/sparkline-active.js"></script>
    <!-- calendar JS
		============================================ -->
    <script src="/js/calendar/moment.min.js"></script>
    <script src="/js/calendar/fullcalendar.min.js"></script>
    <script src="/js/calendar/fullcalendar-active.js"></script>
    <!-- plugins JS
		============================================ -->
    <script src="/js/plugins.js"></script>
    <!-- main JS
		============================================ -->
    <script src="/js/numeral.js"></script>
	<script src="/js/main.js"></script>
 	<script src="/js/util/color.js"></script>
	<script src="/js/util/ajaxAPI.js"></script>
	<script src="/js/util/alert.js"></script>
    <script>

		const renderRoomTypeRow = (index,item) => {
			return `
				<tr>
					<td>${index + 1}</td>
					<td>${item.type}</td>
					<td>${numeral(item.value).format('0,0') + " VND"}</td>
					<td>${numeral(item.ratio).format('0%')}</td>
				</tr>
			`
		}

		const renderRoomDensityRow = (index,item) => {
			return `
				<tr>
					<td>${index + 1}</td>
					<td>${item.room}</td>
					<td>${item.value}</td>
					<td>${numeral(item.ratio).format('0%')}</td>
				</tr>
			`
		}

		const renderRoomTypeChart = (roomTypeData) => {
			const roomTypeChartCtx = document.getElementById("room-type-chart");
			const roomTypeChart = new Chart(roomTypeChartCtx, {
				type: 'pie',
				data: {
					labels: Object.keys(roomTypeData),
					datasets: [{
						label: 'pie Chart',
						backgroundColor: Object.keys(roomTypeData).map((item)=> "#" + getRandomColor()),
						data: Object.keys(roomTypeData).map((item)=> roomTypeData[item].value)
					}]
				},
				options: {
					responsive: true
				}
			});
		}

		const renderRoomDensityChart = (roomDensityData) => {
			const roomDensityChartCtx = document.getElementById("room-density-chart");
			const roomDensityChart = new Chart(roomDensityChartCtx, {
				type: 'pie',
				data: {
					labels: Object.keys(roomDensityData),
					datasets: [{
						label: 'pie Chart',
						backgroundColor: Object.keys(roomDensityData).map((item)=> "#" + getRandomColor()),
						data: Object.keys(roomDensityData).map((item)=> roomDensityData[item].value)
					}]
				},
				options: {
					responsive: true
				}
			});
		}



		const roomTypeSuccessCallback = (data) => {
			if(data.success){
				const resultRoomType = data.data.resultRoomType;
				console.log(resultRoomType)
				let isNotEmpty = 0;
				Object.keys(resultRoomType).forEach(key=>{
					isNotEmpty += resultRoomType[key].value;
				});
				if(isNotEmpty){
					console.log(resultRoomType);
					$("#data-container-1").show();
					$("#table-body-1").empty();
					Object.keys(resultRoomType).forEach((key,index)=>{
						$("#table-body-1").append(renderRoomTypeRow(index, {type:key, ...resultRoomType[key]}))
					});
					renderRoomTypeChart(resultRoomType);
				}
				else{
					$("#data-container-1").hide();
					createAlert("info", "Không có dữ liệu")
				}
				
			}
			else{
				createAlert("error", data.message)
			}
		}

		const roomDensitySuccessCallback = (data) => {
			if(data.success){
				const resultRoomDensity = data.data.resultRoomDensity;
				console.log(resultRoomDensity)
				let isNotEmpty = 0;
				Object.keys(resultRoomDensity).forEach(key=>{
					isNotEmpty += resultRoomDensity[key].value;
				});
				if(isNotEmpty){
					console.log(resultRoomDensity);
					$("#data-container-2").show();
					$("#table-body-2").empty();
					Object.keys(resultRoomDensity).forEach((key,index)=>{
						$("#table-body-2").append(renderRoomDensityRow(index, {room:key, ...resultRoomDensity[key]}))
					});
					renderRoomTypeChart(resultRoomDensity);
				}
				else{
					$("#data-container-2").hide();
					createAlert("info", "Không có dữ liệu")
				}
				
			}
			else{
				createAlert("error", data.message)
			}
		}

		const errorCallback = (error) => {
			console.log(error);
			createAlert("error", "Có lỗi xảy ra, vui lòng thử lại!")
		}

		const  roomTypeSubmitQuery = (ele) => {
			const data = {};
			data.month =  $("select[name='month1']").val();
			data.year =  $("select[name='year1']").val();
			console.log(data);
			fetchData('get', data, '/api/room-type', roomTypeSuccessCallback, errorCallback);
		}

		const  roomDensitySubmitQuery = (ele) => {
			const data = {};
			data.month =  $("select[name='month2']").val();
			data.year =  $("select[name='year2']").val();
			console.log(data);
			fetchData('get', data, '/api/room-density', roomDensitySuccessCallback, errorCallback);
		}

		const roomTypeData = {{{json resultRoomType}}};
		const roomDensityData = {{{json resultRoomDensity}}};
		$(document).ready(()=>{
			renderRoomTypeChart(roomTypeData);
			renderRoomDensityChart(roomDensityData);
			const currentYear = new Date().getFullYear();
			for(i = currentYear; i >= 1970; i--){
				if(i == currentYear){
					$("#year1").append(`<option selected value="${i}">${i}</option>`)
					$("#year2").append(`<option selected value="${i}">${i}</option>`)
				}
				else{
					$("#year1").append(`<option value="${i}">${i}</option>`)
					$("#year2").append(`<option value="${i}">${i}</option>`)
				}
			}
			const currentMonth = new Date().getMonth() + 1;
			for(i = 1; i <= 12; i++){
				if(i === currentMonth){
					$("#month1").append(`<option selected value="${i}">${i}</option>`)
					$("#month2").append(`<option selected value="${i}">${i}</option>`)
				}
				else{
					$("#month1").append(`<option value="${i}">${i}</option>`)
					$("#month2").append(`<option value="${i}">${i}</option>`)
				}
			}
		})
    </script>
{{/section}}